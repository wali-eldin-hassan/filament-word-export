# Filament Word Export Plugin

A Filament plugin for exporting table data to Microsoft Word (DOCX) format.

## Requirements

- PHP 8.3+
- Laravel 11.x or 12.x
- Filament 3.x or 4.x

## Installation

You can install the package via composer:

```bash
composer require wali/filament-word-export
```

## Usage

### Basic Usage

Add the export action to your Filament table:

```php
use Wali\FilamentWordExport\Actions\ExportToWordAction;

public function table(Table $table): Table
{
    return $table
        ->columns([
            // Your table columns
        ])
        ->bulkActions([
            ExportToWordAction::make(),
        ]);
}
```

### Customizing Headers and Footers

You can customize headers and footers per action:

```php
use Wali\FilamentWordExport\Actions\ExportToWordAction;

public function table(Table $table): Table
{
    return $table
        ->bulkActions([
            // Custom header and footer text
            ExportToWordAction::make()
                ->headerText('My Company Report')
                ->footerText('Confidential Document')
                ->withPageNumbers(),

            // Disable headers/footers entirely
            ExportToWordAction::make('export-clean')
                ->label('Export (Clean)')
                ->withoutHeader()
                ->withoutFooter(),

            // Custom filename
            ExportToWordAction::make('export-custom')
                ->filename('custom-report-' . now()->format('Y-m-d') . '.docx'),
        ]);
}
```

### Advanced Customization

For more advanced customization, you can use template overrides:

```php
ExportToWordAction::make()
    ->templateOverrides([
        'header.style.size' => 12,
        'header.style.color' => '0066CC',
        'footer.style.italic' => true,
        'footer.page_number_alignment' => 'left',
    ])
```

### Optional: End-User Custom Template Upload

You can allow users to upload their own `.docx` template (which may contain a `TABLE_DATA` placeholder) at export time. Enable this on the action:

```php
ExportToWordAction::make()
    ->allowCustomTemplateUpload(); // Optionally pass (true, 'custom-directory')
```

Configuration (published file) provides defaults:

```php
'custom_template' => [
    'enabled' => true,
    'directory' => 'word-templates',
    'max_size_mb' => 5,
],
```

Template Usage:

- Upload a `.docx` file during the bulk action.
- Include `${TABLE_DATA}` in the document where you want a plain-text representation of the selected records.
- If no placeholder is found, the template is exported unchanged except for basic value substitution (future enhancements may add more placeholders).

Fallback Behavior: If the uploaded template cannot be processed, the system silently falls back to the default generated table layout.

### Adding Custom Template Variables

Allow users to type placeholder variables that will be replaced in the uploaded template using PHPWord's `TemplateProcessor`:

```php
ExportToWordAction::make()
    ->allowCustomTemplateUpload()
    ->allowCustomVariables();
```

During the action, a "Template Variables" key/value editor appears. If a user adds:

| Key            | Value            |
|----------------|------------------|
| company_name   | Acme Inc         |
| report_date    | 2025-10-07       |

Then placeholders `${company_name}` and `${report_date}` in the .docx will be replaced.

Notes:
* Enter keys without the `${}` wrapper (just `company_name`).
* Non-scalar values are JSON-encoded.
* All replacements occur after `${TABLE_DATA}` injection.
* Missing placeholders in the template are ignored silently.

## Configuration

Publish the configuration file:

```bash
php artisan vendor:publish --tag="filament-word-export-config"
```

### Configuration Options

The configuration file allows you to set default values for headers and footers:

```php
return [
    'header' => [
        'enabled' => true,
        'text' => 'Generated by Filament Word Export Plugin',
        'style' => [
            'italic' => true,
            'size' => 10,
            'color' => '000000',
            'alignment' => 'center',
        ],
        'logo' => [
            'enabled' => false,
            'path' => null, // e.g., 'logos/company-logo.png'
            'width' => 100,
            'height' => 50,
            'alignment' => 'left',
        ],
    ],
    'footer' => [
        'enabled' => true,
        'text' => 'Generated via Filament Word Export Plugin',
        'style' => [
            'size' => 9,
            'color' => '999999',
            'alignment' => 'center',
        ],
        'show_page_numbers' => true,
        'page_number_format' => 'Page {PAGE} of {NUMPAGES}',
        'page_number_alignment' => 'right',
    ],
];
```

## Development

This project uses Laravel Pint for code formatting and Rector for automated refactoring.

### Code Formatting with Pint

```bash
# Check code style
composer lint:test

# Fix code style issues
composer lint

# Fix only dirty files (git)
composer lint:dirty
```

### Code Refactoring with Rector

```bash
# Preview changes (dry run)
composer refactor:dry

# Apply refactoring changes
composer refactor
```

### Combined Commands

```bash
# Check formatting and preview refactoring
composer format

# Apply both formatting and refactoring
composer fix
```

### Manual Tool Usage

You can also run the tools directly:

```bash
# Pint
./vendor/bin/pint
./vendor/bin/pint --test
./vendor/bin/pint --dirty

# Rector
./vendor/bin/rector process
./vendor/bin/rector process --dry-run
```

## Configuration Files

- `pint.json` - Laravel Pint configuration
- `rector.php` - Rector configuration
- `config/filament-word-export.php` - Plugin configuration

## License

The MIT License (MIT). Please see [License File](LICENSE.md) for more information.
